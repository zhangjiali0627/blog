---
layout: post
categories: js
title: "网页性能"
subtitle: "本文将介绍性能问题的出现原因及解决办法"
featured-image: /images/img/anchor.jpg
tags: ['前端交互']
date-string: Jun 5, 2020
---

#### 前言

你遇到过性能很差的网页吗？

这种网页响应非常缓慢，占用大量的CPU和内存，浏览起来特别卡顿，页面中的动画效果也不流畅。

你会有什么反应？

大多数用户应该都会关闭这个页面，作为开发者，我们肯定不愿意看到这种情况，那我们应该怎样提高性能呢？

## 一、网页生成的过程

要理解网页的性能为什么不好，就必须了解网页是怎么生成的。

网页的生成过程，可以分为5步：

1. HTML代码转化为DOM tree
2. CSS代码转化为CSS tree （CSSOM  CSS Object Model）
3. 合成DOM tree 和 CSS tree，生成一棵渲染树（包含每个节点的视觉信息）
4. 生成(layout)布局，也就是将所有渲染树的所有节点进行平面合成；
5. 将布局绘制在屏幕上（paint)

前三步是非常快的，第四步和第五步比较耗时；

- "生成布局"（flow）和"绘制"（paint）这两步，合称为"渲染"（render）。

<img src="/images/img/render.png" alt="" >


## 二、重排和重绘

网页生成的时候，至少会渲染一次。用户访问的过程中，还会不断重新渲染。

导致网页重新渲染的几种可能的情况：
- 修改DOM
- 修改样式表
- 用户事件（比如鼠标悬停、页面滚动、输入框键入文字、改变窗口的大小等等）

重新渲染，就需要重新生成布局和重新绘制。

- 生成布局：即重排；（reflow）
- 重新绘制：即重绘；（repaint）

需要注意的是：

- “重绘”不一定需要“重排”，比如改变某个网页元素的颜色，就只会触发“重绘”，不会触发“重排”，因为布局没有改变；
- “重排”必然会导致“重绘”，比如改变了一个网页元素的位置，就会同时出发“重排”和“重绘”，因为布局发生了改变。

## 三、对于性能的影响

重排和重绘不断触发是不可避免的。但是，它们非常耗费资源，是导致网页性能低下的根本原因。

#### 提高网页性能，就是要降低“重排”和“重绘”的频率和成本，尽量减少触发重新渲染。

我们前面已经提到，DOM变动和样式变动，都会触发重新渲染。但是浏览器已经很智能了，会尽量把所有的变动集中在一起，排成一个队列，然后一次性执行，尽量避免多次重新渲染。

## 总结
    以上就是在react中实现锚链接的方式以及监听滚动条的方法,当然也有实现类似效果的其他方法,后续会逐步补充!